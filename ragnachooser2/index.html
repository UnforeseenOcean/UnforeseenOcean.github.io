<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>
    <title>RagnaChooser 2: The Electric Boogaloo</title>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <style>
        :root {
            --background-light: #ffffff;
            --text-light: #000000;
            --menu-bg-light: #333333;
            --menu-text-light: #ffffff;
            --button-light: #a9a9a9;
            --button-text-light: #ffffff;

            --background-dark: #202020;
            --text-dark: #ffffff;
            --menu-bg-dark: #303030;
            --menu-text-dark: #ffffff;
            --button-dark: #606060;
            --button-text-dark: #ffffff;

            --background-hicon: #000000;
            --text-hicon: #ffff00;
            --menu-bg-hicon: #000000;
            --menu-text-hicon: #ffff00;
            --button-hicon: #101010;
            --button-text-hicon: #ffff00;
        }

        /* High-contrast mode colors */
        .page-top.hicon {
            background-color: #000000;
            color: #ffff00;
        }

        .prev.hicon,
        .next.hicon {
            background-color: #101010;
            color: #ffff00;
        }

        .hicon {
            background-color: #000000;
            color: #ffff00;
        }

        /* Dark mode colors */

        .page-top.dark {
            background-color: #202020;
            color: #ffffff;
        }

        .prev.dark,
        .next.dark {
            background-color: #606060;
            color: #ffffff;
        }

        .dark {
            background-color: #303030;
            color: #ffffff;
        }

        body {
            font-family: "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "DejaVu Sans", Verdana, "sans-serif";
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-light);
        }

        .page-container {
            width: 100%;
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page-top {
            background-color: var(--menu-bg-light);
            color: var(--menu-text-light);
            padding: 10px;
            border-radius: 15px;
        }

        .page-mid {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            min-height: 200px;
            flex: 1;
        }

        .center {
            font-weight: bold;
            font-size: 4em;
            text-align: center;
        }

        .prev,
        .next {
            font-weight: bold;
            font-size: 1.25em;
            background-color: #A9A9A9;
            padding: 25px 15px;
            border-radius: 15px;
            cursor: pointer;
            background-color: var(--button-light);
            color: var(--button-text-light);
        }

        .footer {
            width: 100%;
            font-size: 1.25em;
            text-align: center;
        }

        .no {
            -webkit-user-select: none;
            /* Safari */
            -ms-user-select: none;
            /* IE 10 and IE 11 */
            user-select: none;
            /* Standard syntax */
        }

        button {
            font-size: 1.5em;
        }

        input[type="number"] {
            font-size: 1.5em;
            width: 80px;
        }

        input[type="checkbox"] {
            transform: scale(2);
            -webkit-transform: scale(2);
            -ms-transform: scale(2);
        }

        input[type="radio"] {
            transform: scale(2);
            -webkit-transform: scale(2);
            -ms-transform: scale(2);
        }

        .hidden {
            opacity: 0 !important;
            /* KABOOM */
        }

        .disabled {
            display: none !important;
            /* DOUBLE KABOOM */
        }

        .more-text.one,
        .more-text.four {
            opacity: 0.25;
            font-size: 2.25em;
        }

        .more-text.two,
        .more-text.three {
            opacity: 0.5;
            font-size: 2.75em;
        }

        .easy {
            color: #19BD00;
        }

        .medium {
            color: #CB8800;
        }

        .hard {
            color: #CB0000;
        }

        .menu-btn {
            position: fixed;
            left: 50px;
            bottom: 50px;
        }

        .menu-div {
            display: none;
            position: fixed;
            left: 150px;
            bottom: 50px;
        }

        .show {
            display: block;
        }

        .fade {
            opacity: 0.25;
        }

        .cookie-nag-container {
            width: 100%;
            height: 100%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.5);
            z-index: 9999999999;
        }

        .cookie-nag {
            position: absolute;
            background-color: white;
            color: black;
            text-align: center;
            display: flex;
            flex-direction: column;
            border: outset;
            border-width: thick;
            padding: 15px;
        }

        .cookie {
            font-size: 4em;
            animation: shake 0.25s linear infinite;
        }

        .cookie-nag-title {
            font-size: 2em;
        }

        .small-text {
            font-size: 0.6em;
        }

        .cookie-reject {
            background-color: lightgray;
            color: black;
        }

        .cookie-accept {
            background-color: #55BB49;
            font-size: 4em;
            width: 250px;
            height: 100px;
            color: black;
            font-weight: bold;
        }

        .placeholder {
            line-height: 0.75em;
        }

        .error-notice {
            font-weight: bold;
            font-size: 1.25em;
            background-color: lightgray;
            border-style: groove;
            border-color: lightgray;
            border-width: 4px;
            padding: 5px;
            text-align: center;
        }

        .eol-notice {
            position: absolute;
            z-index: 99999999999;
            font-weight: bold;
            font-size: 1.25em;
            background-color: lightgray;
            border-style: groove;
            border-color: lightgray;
            border-width: 4px;
            padding: 5px;
            text-align: center;
        }

        /* End of definition */

        /* CSS Var */
        body.dark {
            --bg: var(--background-dark);
            --txt: var(--text-dark);
        }

        .page-top.dark {
            --mbg: var(--menu-bg-dark);
            --mtxt: var(--menu-text-dark);
        }

        .next.dark,
        .prev.dark {
            --btn: var(--button-dark);
            --btxt: var(--button-text-dark);
        }

        body.hicon {
            --bg: var(--background-hicon);
            --txt: var(--text-hicon);
        }

        .page-top.hicon {
            --mbg: var(--menu-bg-hicon);
            --mtxt: var(--menu-text-hicon);
        }

        .next.hicon,
        .prev.hicon {
            --btn: var(--button-hicon);
            --btxt: var(--button-text-hicon);
        }

        body.dark,
        body.hicon {
            background-color: var(--bg);
            color: var(--txt);
        }

        .page-top.dark,
        .page-top.hicon {
            background-color: var(--mbg);
            color: var(--mtxt);
        }

        .next.dark,
        .prev.dark,
        .next.hicon,
        .prev.hicon {
            background-color: var(--btn);
            color: var(--btxt);
        }

        @keyframes shake {
            0% {
                transform: translate(2px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-2deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(3deg);
            }

            30% {
                transform: translate(0px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(2px, 1px) rotate(-2deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(4deg);
            }

            90% {
                transform: translate(2px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        @keyframes blink {
            0% {
                opacity: 0;
            }

            9.99% {
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            19.99% {
                opacity: 1;
            }

            20% {
                opacity: 0;
            }

            29.99% {
                opacity: 0;
            }

            30% {
                opacity: 1;
            }

            39.99% {
                opacity: 1;
            }

            40% {
                opacity: 0;
            }

            49.99% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            59.99% {
                opacity: 1;
            }

            60% {
                opacity: 0;
            }

            69.99% {
                opacity: 0;
            }

            70% {
                opacity: 1;
            }

            79.99% {
                opacity: 1;
            }

            80% {
                opacity: 0;
            }

            89.99% {
                opacity: 0;
            }

            90% {
                opacity: 1;
            }

            99.99% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        #cd {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: black;
            padding: 10px;
            font-family: Consolas, "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", Monaco, "Courier New", "monospace";
            font-size: 16px;
            z-index: 9999999999999;
        }
    </style>
</head>

<body class="light"> <!-- CSS -->
    <div id="cd"></div>
    <div class="page-container">
        <div class="cookie-nag-container" id="cookienag-hideme">
            <div class="cookie-nag">
                <div class="cookie">🍪</div>
                <div class="cookie-nag-title">Oh my, browser cookie! Whatever I will do?!</div>
                <div class="cookie-nag-content">This site uses cookies for storing your settings. No ads or tracking or anything like that. Just settings.<br />
                    Please click the big &quot;OKAY&quot; button below if you are okay with it.</div>
                <div class="cookie-nag-content">If you do not agree, press &quot;NO WAY&quot; button instead. The page will function regardless.<br />You will see this message again because we can't save the settings. That's how the cookie crumbles. <span class="small-text">Sorry. Again.</span></div>
                <div class="cookie-nag-content">Also, once you agree, please refresh the page.</div>
                <div class="cookie-nag-buttons"><button class="cookie-reject" onClick="closeDialog(false)">NO WAY</button>&nbsp;<button class="cookie-accept" onClick="closeDialog(true)">OKAY</button></div>
            </div>
            <div class="error-notice">
                <p>If you see this text in the center and can't do anything, please disable Adblocker.</p>
                <p>Looks like some "cookie nag remover" functions detect it as nuisance.</p>
                <p>I promise you, I never put any ads on the pages. If there's one, you've got a virus.</p>
                <p>To close this modal dialog and continue without save function, </p>
                <p>click on the button below:</p>
                <button onclick="closeDialog(false);">Close</button>
            </div>
            <div class="eol-notice" id="eolnotice">
                <p>Yes, the time has come for this silly little tool.</p>
                <p>I am unable to update this tool any longer.</p>
                <p>This tool is in &quot;End of life&quot; state.</p>
                <p>No further support will be provided.</p>
                <p>Please see <a href="/rc-eol">This page</a> for more information.</p>
                <p>To continue using this tool anyway, press the button below.</p>
                <button onclick="closeDialog(true);">Close</button>
            </div>
        </div>
        <div class="page-top light" id="pgtop"> <!-- CSS -->
            <div class="title">RagnaChooser V2</div>
            <input class="picker" type="checkbox" name="v1" id="v1" onChange="updateConfig(0)">
            <label for="v1">Volume 1</label>&nbsp;
            <input class="picker" type="checkbox" name="v2" id="v2" onChange="updateConfig(1)">
            <label for="v2">Volume 2</label>&nbsp;
            <input class="picker" type="checkbox" name="gh" id="gh" onChange="updateConfig(2)">
            <label for="gh">Gloryhammer Raid</label>&nbsp;
            <input class="picker" type="checkbox" name="hf" id="hf" onChange="updateConfig(3)">
            <label for="hf">Hellfest Raid</label>&nbsp;
            <input class="picker" type="checkbox" name="nb" id="nb" onChange="updateConfig(4)">
            <label for="nb">Nuclear Blast Raid</label>&nbsp;
            <input class="picker" type="checkbox" name="sb" id="sb" onChange="updateConfig(5)">
            <label for="sb">Sabaton Raid</label>&nbsp;
            <input class="picker" type="checkbox" name="jy" id="jy" onChange="updateConfig(6)">
            <label for="jy">Jonathan Young Raid</label>&nbsp;
            <div class="placeholder">&nbsp;</div>
            <input class="picker" type="checkbox" name="as" id="as" onChange="updateConfig(7)">
            <label for="as">Alestorm Raid</label>&nbsp;
            <div class="placeholder">&nbsp;</div>
            <input class="option" type="checkbox" name="sort" id="sort" onChange="updateConfig(1023)">
            <label for="sort">Sort songs by intensity</label>
            <input class="option" type="checkbox" name="difficulty" id="diff" onChange="updateConfig(666)" checked>
            <label for="difficulty">Also Pick Difficulty</label>

            <input class="radio menu" type="radio" name="showtype" id="showone" onChange="updateView(0)" checked>
            <label for="showone">Show One</label>
            <input class="radio menu" type="radio" name="showtype" id="showmore" onChange="updateView(1)">
            <label for="showmore">Show More</label>
            <input class="radio menu" type="radio" name="showtype" id="showall" onChange="updateView(2)">
            <label for="showall">Show All</label>
            <div class="placeholder">&nbsp;</div>
            <input class="count" type="number" name="count" id="count" value="10" min="1" max="90" onChange="updateConfig(99)">
            <label for="count" class="no">&nbsp;songs</label>
            <button class="button" id="less" onClick="buttonHandler(false)">Less Songs</button>
            <button class="button" id="more" onClick="buttonHandler(true)">More Songs</button>
            <button class="button" id="button" onClick="makePlaylist()">Make Playlist!</button>
        </div>
        <div class="shim"><span class="shim-text no" id="counter"> 0 of 0 songs in playlist</span></div>
        <div class="page-mid">
            <div class="prev no light" id="prev" onClick="showPlaylist(false)">&larr; Prev</div> <!-- CSS -->
            <div class="column-wrapper">
                <div class="center more-text one no hidden" id="text1">The Blue Box - To Live Is To Suffer</div>
                <div class="center more-text two no hidden" id="text2">Blackbeard - The Ship Has Sailed</div>
                <div class="center no" id="center">Press Make Playlist!</div>
                <div class="center more-text three no hidden" id="text3">Malmen - Flowers</div>
                <div class="center more-text four no hidden" id="text4">The Undefined - Integer Blues</div>
            </div>
            <div class="next no light" id="next" onClick="showPlaylist(true)">Next &rarr;</div> <!-- CSS -->
        </div>
    </div>
    <div class="footer no">
        &copy; 2024 Blackbeard. All rights reserved. <br />
        The page contains no trackers at all, so your feedback is important for the improvement of the application.
    </div>
    <div class="menu-div" id="menudiv">
        <button onClick="clearLocalStorage()">Clear Settings</button>
        &nbsp;
        <input type="radio" name="scrmode" id="litemode" onChange="setDisplayMode(0)">
        <label for="litemode" class="no">Light Mode</label>
        &nbsp;
        <input type="radio" name="scrmode" id="darkmode" onChange="setDisplayMode(1)">
        <label for="darkmode" class="no">Dark Mode</label>
        &nbsp;
        <input type="radio" name="scrmode" id="hiconmode" onChange="setDisplayMode(2)">
        <label for="hiconmode" class="no">High Contrast</label>
        <div class="menu-controls no">
            Controls: A/D = Flick through songs, W/S: Adjust song count,<br />
            ZXCVBNM: Toggle filters, Q: Toggle sorting, Enter: Generate<br />
            Pressing W/S will also regenerate the playlist. <br />
        </div>
    </div>
    <div class="menu-btn">
        <button class="menu-btn-deco" onClick="toggleMenu();">Menu</button>
    </div>

    <script src="js/jquery.js"></script>
    <script>
        // Internal variables
        var songCount = 10;
        var playlistIndex = 0;
        var config = [0, 0, 0, 0, 0, 0, 0, 0]; // includeVol1, includeVol2, includeGH, includeHF, includeNB, includeSB, includeAS
        var sortEnabled = false;
        var diffEnabled = false;
        var playlistArray = [];
        var showMode = 0;

        // DOM shortcuts
        var counter = $("#counter");
        var count = $("#count");
        var title = $("#center");
        var twobefore = $("#text1");
        var onebefore = $("#text2");
        var oneafter = $("#text3");
        var twoafter = $("#text4");

        // Default data as a fallback
        var userData = {
            cookieAccepted: false,
            displayMode: 0,
            filterConfig: [0, 0, 0, 0, 0, 0, 0, 0],
            songCount: 10,
            songFormat: 0,
            displayDiff: false,
            sortSongs: false
        }

        function toggleMenu() {
            var dom = $("#menudiv");
            dom.toggleClass("show");
        }

        function closeDialog(accepted) {
            if (!accepted) {
                $("#cookienag-hideme").hide();
            } else {
                setLocalStorage("cookie", true);
                $("#cookienag-hideme").hide();
            }
        }

        window.onload = function() {
            initPage();
            countdown();
        }

        function initPage() {
            // This function must be called when DOM is loaded
            // and close the nag message before the user sees it
            getLocalStorage();
            if (userData.cookieAccepted === true) {
                closeDialog(false); // no need to set it again, just close it
            }
            applySettingsFromLS();
        }

        function applySettingsFromLS() {
            // define some shorthand vars
            var dm = userData.displayMode;
            var fc = userData.filterConfig;
            var sc = userData.songCount;
            var sf = userData.songFormat;
            var df = userData.displayDiff;
            var ss = userData.sortSongs;

            console.info(dm + ", " + fc + ", " + sc + ", " + sf + ", " + df + ", " + ss);

            // define DOM shortcuts
            var rblite = $("#litemode");
            var rbdark = $("#darkmode");
            var rbhicon = $("#hiconmode");
            var showone = $("#showone");
            var showmore = $("showmore");
            var showall = $("#showall");
            var showdiff = $("#diff");
            var sort = $("#sort");

            // set display mode
            setDisplayMode(dm);
            switch (dm) {
                case 0:
                    rblite.prop("checked", true).trigger("click");
                    break;
                case 1:
                    rbdark.prop("checked", true).trigger("click");
                    break;
                case 2:
                    rbhicon.prop("checked", true).trigger("click");
                    break;
            } // This will trigger the function twice, but it doesn't really matter in the end...


            // convert numbers into bool

            var sa = fc.map(element => element == 1);
            $(".picker").each(function(i, obj) {
                $(this).prop("checked", sa[i]);
            })
            count.val(sc); // Set the song count, or at least try to

            switch (sf) {
                case 0:
                    showone.prop("checked", true).trigger("click");
                    break;
                case 1:
                    showmore.prop("checked", true).trigger("click");
                    break;
                case 2:
                    showall.prop("checked", true).trigger("click");
                    break;
            }
            showMode = sf;
            showPlaylist("none");
            if (df == true) {
                showdiff.prop("checked", true).trigger("click");
            }
            if (ss == true) {
                sort.prop("checked", true).trigger("click");
            }
        }

        function getLocalStorage() {
            console.log("Trying to get LocalStorage.");
            // getLocalStorage must be executed when the DOM is fully loaded
            if (localStorage.getItem("cookieAccepted") !== null) {
                userData.cookieAccepted = JSON.parse(localStorage.getItem("cookieAccepted"));
            }
            if (localStorage.getItem("displayMode") !== null) {
                userData.displayMode = JSON.parse(localStorage.getItem("displayMode"));
            }
            if (localStorage.getItem("songsSelected") !== null) {
                userData.filterConfig = JSON.parse(localStorage.getItem("songsSelected"));
            }
            if (localStorage.getItem("songCount") !== null) {
                userData.songCount = JSON.parse(localStorage.getItem("songCount"));
            }
            if (localStorage.getItem("songFormat") !== null) {
                userData.songFormat = JSON.parse(localStorage.getItem("songFormat"));
            }
            if (localStorage.getItem("displayDiff") !== null) {
                userData.displayDiff = JSON.parse(localStorage.getItem("displayDiff"));
            }
            if (localStorage.getItem("sortSongs") !== null) {
                userData.sortSongs = JSON.parse(localStorage.getItem("sortSongs"));
            }
        }

        function clearLocalStorage() {
            const res = confirm("Are you sure you want to clear the settings?");
            if (res == true) {
                localStorage.clear();
                console.info("Settings cleared");
            } else {
                console.info("Canceled");
                return false;
            }
        }

        function setLocalStorage(type, data) {
            console.info("Got call to write value " + data + " to " + type);
            if (userData.cookieAccepted !== false) {
                switch (type) {
                    case "cookie":
                        localStorage.setItem("cookieAccepted", JSON.stringify(data));
                        break;
                    case "displayMode":
                        localStorage.setItem("displayMode", JSON.stringify(data));
                        break;
                    case "songsSelected":
                        localStorage.setItem("songsSelected", JSON.stringify(data));
                        break;
                    case "songCount":
                        localStorage.setItem("songCount", JSON.stringify(data));
                        break;
                    case "songFormat":
                        localStorage.setItem("songFormat", JSON.stringify(data));
                        break;
                    case "displayDiff":
                        localStorage.setItem("displayDiff", JSON.stringify(data));
                        break;
                    case "sortSongs":
                        localStorage.setItem("sortSongs", JSON.stringify(data));
                        break;
                    case "useLokiJS":
                        localStorage.setItem("useLokiJS", JSON.stringify(data));
                        break;
                    default:
                        console.error("You can't invoke setLocalStorage with null as type.");
                        break;
                }
            } else {
                switch (type) {
                    case "cookie":
                        localStorage.setItem("cookieAccepted", JSON.stringify(data));
                        break;
                    default:
                        console.warn("Warning: Application running in demo mode. Call to save '" + type + "' will be ignored.")
                }
            }
        }

        function setDisplayMode(mode) {
            setLocalStorage("displayMode", mode)
            console.log("Screen mode is " + mode);

            // DOM shortcuts
            var body = $("body");
            var topmenu = $("#pgtop");
            var next = $("#next");
            var prev = $("#prev");

            // Clear all classes
            body.removeClass("light dark hicon");
            topmenu.removeClass("light dark hicon");
            next.removeClass("light dark hicon");
            prev.removeClass("light dark hicon");
            if (mode == 0) {
                // Well, we don't need to do anything here, but we will leave it here for now
            } else if (mode == 1) {
                body.addClass("dark");
                topmenu.addClass("dark");
                next.addClass("dark");
                prev.addClass("dark");
            } else if (mode == 2) {
                body.addClass("hicon");
                topmenu.addClass("hicon");
                next.addClass("hicon");
                prev.addClass("hicon");
            }
        }

        var songListGH = [{
                name: "Gloryhammer Raid - Gloryhammer",
                dlc: "gh",
                diff: 16,
                diffList: [2, 6, 8]
            },
            {
                name: "Gloryhammer Raid - Questlords of Inverness Ride to the Galactic Fortress!",
                dlc: "gh",
                diff: 22,
                diffList: [5, 7, 10]
            },
            {
                name: "Gloryhammer Raid - Rise of the Chaos Wizards",
                dlc: "gh",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "Gloryhammer Raid - The Fires of Ancient Cosmic Destiny",
                dlc: "gh",
                diff: 18,
                diffList: [3, 5, 10]
            },
            {
                name: "Gloryhammer Raid - The Land of Unicorns",
                dlc: "gh",
                diff: 17,
                diffList: [3, 5, 9]
            },
            {
                name: "Gloryhammer Raid - The Siege of Dunkeld",
                dlc: "gh",
                diff: 21,
                diffList: [5, 7, 9]
            }
        ];
        var songListHF = [{
                name: "Hellfest Raid - Battlefield",
                dlc: "hf",
                diff: 15,
                diffList: [2, 5, 8]
            },
            {
                name: "Hellfest Raid - Born For One Thing",
                dlc: "hf",
                diff: 19,
                diffList: [4, 7, 8]
            },
            {
                name: "Hellfest Raid - Going Hunting",
                dlc: "hf",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "Hellfest Raid - Great Marquis Of Hell",
                dlc: "hf",
                diff: 17,
                diffList: [3, 6, 8]
            },
            {
                name: "Hellfest Raid - Härjaren",
                dlc: "hf",
                diff: 12,
                diffList: [2, 4, 6]
            },
            {
                name: "Hellfest Raid - Heart Demolition",
                dlc: "hf",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "Hellfest Raid - Life Will Always Find Its Way",
                dlc: "hf",
                diff: 19,
                diffList: [4, 6, 8]
            },
            {
                name: "Hellfest Raid - One For The Road",
                dlc: "hf",
                diff: 14,
                diffList: [3, 5, 6]
            },
            {
                name: "Hellfest Raid - Skyfall",
                dlc: "hf",
                diff: 21,
                diffList: [4, 8, 9]
            },
            {
                name: "Hellfest Raid - Tribal",
                dlc: "hf",
                diff: 16,
                diffList: [3, 5, 8]
            },
            {
                name: "Hellfest Raid - You're Gonna Go Far, Kid",
                dlc: "hf",
                diff: 13,
                diffList: [1, 5, 7]
            }
        ];
        var songListNB = [{
                name: "Nuclear Blast Raid - A Man With A Plan",
                dlc: "nb",
                diff: 17,
                diffList: [3, 5, 9]
            },
            {
                name: "Nuclear Blast Raid - Abyss Of Time",
                dlc: "nb",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "Nuclear Blast Raid - Ambiramus",
                dlc: "nb",
                diff: 14,
                diffList: [2, 4, 8]
            },
            {
                name: "Nuclear Blast Raid - Eye of the Storm",
                dlc: "nb",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "Nuclear Blast Raid - Nevermore",
                dlc: "nb",
                diff: 20,
                diffList: [3, 7, 10]
            },
            {
                name: "Nuclear Blast Raid - One Night In Tokyo",
                dlc: "nb",
                diff: 18,
                diffList: [2, 7, 9]
            },
            {
                name: "Nuclear Blast Raid - Revolution",
                dlc: "nb",
                diff: 20,
                diffList: [4, 7, 9]
            },
            {
                name: "Nuclear Blast Raid - Rise Again",
                dlc: "nb",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "Nuclear Blast Raid - Vodka",
                dlc: "nb",
                diff: 14,
                diffList: [2, 5, 7]
            }
        ];
        var songListSabaton = [{
                name: "Sabaton Raid - Night Witches",
                dlc: "sb",
                diff: 17,
                diffList: [3, 6, 8]
            },
            {
                name: "Sabaton Raid - Resist and Bite",
                dlc: "sb",
                diff: 16,
                diffList: [1, 5, 10]
            },
            {
                name: "Sabaton Raid - Seven Pillars of Wisdom",
                dlc: "sb",
                diff: 19,
                diffList: [2, 7, 10]
            },
            {
                name: "Sabaton Raid - Steel Commanders",
                dlc: "sb",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "Sabaton Raid - Stormtroopers",
                dlc: "sb",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "Sabaton Raid - To Hell and Back",
                dlc: "sb",
                diff: 14,
                diffList: [1, 5, 8]
            }
        ];
        var songListJY = [{
                name: "Jonathan Young Raid - Eye of the Storm",
                dlc: "jy",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "Jonathan Young Raid - Loose Cannon",
                dlc: "jy",
                diff: 16,
                diffList: [2, 5, 9]
            },
            {
                name: "Jonathan Young Raid - Man The Cannons",
                dlc: "jy",
                diff: 18,
                diffList: [2, 7, 9]
            },
            {
                name: "Jonathan Young Raid - Randy Dandy Oh",
                dlc: "jy",
                diff: 15,
                diffList: [1, 5, 9]
            },
            {
                name: "Jonathan Young Raid - Santiana",
                dlc: "jy",
                diff: 15,
                diffList: [1, 6, 8]
            },
            {
                name: "Jonathan Young Raid - Storm the Castle",
                dlc: "jy",
                diff: 21,
                diffList: [4, 7, 10]
            }
        ];
        var songListVol1 = [{
                name: "OST Volume 1 - Au Petit Matin",
                dlc: "v1",
                diff: 23,
                diffList: [5, 8, 10]
            },
            {
                name: "OST Volume 1 - Call of the North",
                dlc: "v1",
                diff: 13,
                diffList: [2, 4, 7]
            },
            {
                name: "OST Volume 1 - Chomp Chomp",
                dlc: "v1",
                diff: 22,
                diffList: [4, 8, 10]
            },
            {
                name: "OST Volume 1 - Dead and Gone",
                dlc: "v1",
                diff: 14,
                diffList: [2, 4, 8]
            },
            {
                name: "OST Volume 1 - Dewey",
                dlc: "v1",
                diff: 14,
                diffList: [2, 5, 7]
            },
            {
                name: "OST Volume 1 - Drunken Dwarves",
                dlc: "v1",
                diff: 17,
                diffList: [2, 6, 9]
            },
            {
                name: "OST Volume 1 - Evier metal",
                dlc: "v1",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "OST Volume 1 - Heroes",
                dlc: "v1",
                diff: 15,
                diffList: [3, 4, 8]
            },
            {
                name: "OST Volume 1 - Hootsforce",
                dlc: "v1",
                diff: 17,
                diffList: [4, 6, 7]
            },
            {
                name: "OST Volume 1 - Iridium",
                dlc: "v1",
                diff: 19,
                diffList: [3, 7, 9]
            },
            {
                name: "OST Volume 1 - Join The Riot",
                dlc: "v1",
                diff: 11,
                diffList: [1, 3, 7]
            },
            {
                name: "OST Volume 1 - Kammthaar",
                dlc: "v1",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "OST Volume 1 - Kampfzwerg",
                dlc: "v1",
                diff: 17,
                diffList: [3, 5, 9]
            },
            {
                name: "OST Volume 1 - Löwenherz",
                dlc: "v1",
                diff: 13,
                diffList: [2, 4, 7]
            },
            {
                name: "OST Volume 1 - Loki",
                dlc: "v1",
                diff: 13,
                diffList: [2, 4, 7]
            },
            {
                name: "OST Volume 1 - Masters of The Galaxy",
                dlc: "v1",
                diff: 17,
                diffList: [3, 5, 9]
            },
            {
                name: "OST Volume 1 - Metfest",
                dlc: "v1",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "OST Volume 1 - Mexico",
                dlc: "v1",
                diff: 16,
                diffList: [3, 5, 8]
            },
            {
                name: "OST Volume 1 - Mine Mine Mine!",
                dlc: "v1",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "OST Volume 1 - Nitro",
                dlc: "v1",
                diff: 15,
                diffList: [1, 5, 9]
            },
            {
                name: "OST Volume 1 - No Grave But The Sea",
                dlc: "v1",
                diff: 17,
                diffList: [3, 5, 9]
            },
            {
                name: "OST Volume 1 - Red Wine Teeth",
                dlc: "v1",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "OST Volume 1 - The Great Pirate Bottle",
                dlc: "v1",
                diff: 21,
                diffList: [4, 7, 10]
            },
            {
                name: "OST Volume 1 - The Next One Down",
                dlc: "v1",
                diff: 15,
                diffList: [2, 5, 8]
            },
            {
                name: "OST Volume 1 - To Erebor",
                dlc: "v1",
                diff: 17,
                diffList: [4, 5, 8]
            },
            {
                name: "OST Volume 1 - Tortuga",
                dlc: "v1",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "OST Volume 1 - Universe on fire",
                dlc: "v1",
                diff: 17,
                diffList: [2, 6, 9]
            },
            {
                name: "OST Volume 1 - Valhalleluja",
                dlc: "v1",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "OST Volume 1 - Welcome To Asgard",
                dlc: "v1",
                diff: 10,
                diffList: [1, 3, 6]
            },
            {
                name: "OST Volume 1 - Whaole",
                dlc: "v1",
                diff: 17,
                diffList: [3, 5, 9]
            }
        ];
        var songListVol2 = [{
                name: "OST Volume 2 - Hypa Hypa",
                dlc: "v2",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "OST Volume 2 - Mediator",
                dlc: "v2",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "OST Volume 2 - Memento Mori",
                dlc: "v2",
                diff: 15,
                diffList: [2, 5, 8]
            },
            {
                name: "OST Volume 2 - Metal United",
                dlc: "v2",
                diff: 15,
                diffList: [3, 5, 7]
            },
            {
                name: "OST Volume 2 - Niemi",
                dlc: "v2",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "OST Volume 2 - Out Of Control",
                dlc: "v2",
                diff: 13,
                diffList: [2, 4, 7]
            },
            {
                name: "OST Volume 2 - Powersnake",
                dlc: "v2",
                diff: 18,
                diffList: [4, 6, 8]
            },
            {
                name: "OST Volume 2 - Redneck Vikings From Hell",
                dlc: "v2",
                diff: 20,
                diffList: [3, 7, 10]
            },
            {
                name: "OST Volume 2 - Utopia",
                dlc: "v2",
                diff: 15,
                diffList: [2, 5, 8]
            },
            {
                name: "OST Volume 2 - We Are The Fire",
                dlc: "v2",
                diff: 17,
                diffList: [3, 6, 8]
            },
            {
                name: "OST Volume 2 - Sanaton Maa",
                dlc: "v2",
                diff: 16,
                diffList: [2, 6, 8]
            },
            {
                name: "OST Volume 2 - Only Human",
                dlc: "v2",
                diff: 18,
                diffList: [2, 6, 10]
            },
            {
                name: "OST Volume 2 - Northern Lights",
                dlc: "v2",
                diff: 14,
                diffList: [2, 5, 7]
            },
            {
                name: "OST Volume 2 - Gates of Ekrund",
                dlc: "v2",
                diff: 16,
                diffList: [2, 6, 8]
            }
        ];
        var songListAS = [{
                name: "Alestorm Raid - Alestorm",
                dlc: "as",
                diff: 18,
                diffList: [3, 6, 9]
            },
            {
                name: "Alestorm Raid - Drink",
                dlc: "as",
                diff: 14,
                diffList: [2, 5, 7]
            },
            {
                name: "Alestorm Raid - Keelhauled",
                dlc: "as",
                diff: 17,
                diffList: [3, 6, 8]
            },
            {
                name: "Alestorm Raid - P.A.R.T.Y.",
                dlc: "as",
                diff: 20,
                diffList: [4, 7, 9]
            },
            {
                name: "Alestorm Raid - Shipwrecked",
                dlc: "as",
                diff: 21,
                diffList: [4, 7, 10]
            },
            {
                name: "Alestorm Raid - Treasure Chest Party Quest",
                dlc: "as",
                diff: 17,
                diffList: [3, 6, 8]
            }
        ];

        const ragnaSort = (a, b) => {
            for (let i = 0; i < a.diffList.length; i++) {
                if (a.diffList[i] !== b.diffList[i]) {
                    return a.diffList[i] - b.diffList[i];
                }
            }
            return a.name.localeCompare(b.name);
        };

        function ragnaSortShim(array) {
            var tmp = array; // Copy array into a new one which will mutate
            var tmp2 = tmp.sort(ragnaSort);
            var c = 0
            var tmp3 = tmp2.map(element => {
                try { // try...catch is a bit redundant here but whatever 
                    element.diff = c;
                    c++;
                } catch (error) {
                    console.error(error);
                }
                return element;
            })

            return tmp3;
        }

        // Greetz: dubmood, crome, zalza, radix, arachno, MrGamer, 8bitbubsy, rez, JosSs, seablue, Soft Maniac, coma, maktone, cerror, LHS/DFS, Ghidorah, Beldoroon, mark knight/The Dark Knight, Zabutom, Razor1911, Conspiracy/CPY, fitgirl, strict9, Nick Skarny, Wanadev Studio, JamieDerg
        function makePlaylist() {
            console.info("Generating new playlist...");
            playlistIndex = 0;
            updateConfig(512);
            var tempPL = [];
            playlistArray = []; // empty out previous playlist
            if (config[0] == true) {
                tempPL = tempPL.concat(songListVol1);
            }
            if (config[1] == true) {
                tempPL = tempPL.concat(songListVol2);
            }
            if (config[2] == true) {
                tempPL = tempPL.concat(songListGH);
            }
            if (config[3] == true) {
                tempPL = tempPL.concat(songListHF);
            }
            if (config[4] == true) {
                tempPL = tempPL.concat(songListNB);
            }
            if (config[5] == true) {
                tempPL = tempPL.concat(songListSabaton);
            }
            if (config[6] == true) {
                tempPL = tempPL.concat(songListJY);
            }
            if (config[7] == true) {
                tempPL = tempPL.concat(songListAS);
            }
            if ((allAreFalse(config)) == true) {
                tempPL = tempPL.concat(songListVol1);
                tempPL = tempPL.concat(songListVol2);
                tempPL = tempPL.concat(songListGH);
                tempPL = tempPL.concat(songListHF);
                tempPL = tempPL.concat(songListNB);
                tempPL = tempPL.concat(songListSabaton);
                tempPL = tempPL.concat(songListJY);
                tempPL = tempPL.concat(songListAS);
            }
            for (var f = 0; f < tempPL.length; f++) {
                // Generate the selection of difficulties
                tempPL[f].picked = generateDiffIndex();
            }
            // console.log(tempPL);
            var shuffled = shuffle(tempPL);
            var holdArray = []; // Kinda inefficient way to ensure we have something to sort for later
            if (songCount == 0) {
                alert("RagnaChooser V2 2.5.0 by Blackbeard\nApril 5, 2025 - Partial Rewrite by JamieDerg\nFor Ragnarock (C) 2022-2024 Wanadev Studio\nThank you for using my tool, I hope you have fun.\nSpecial thanks to Nicolas and BloculusMonster!\nPlease put in a value above 1 to make the playlist!");
            }
            if (songCount > shuffled.length) {
                songCount = shuffled.length;
            }
            if (songCount > 0) {
                for (var c = 0; c < songCount; c++) {
                    holdArray.push(shuffled[c]);
                }
                var hack = ragnaSortShim(holdArray); // A very ugly hack
                if (sortEnabled == true) {
                    hack.sort((a, b) => (a.diff > b.diff) ? 1 : -1);
                }
                playlistArray = holdArray;
                console.log(playlistArray);
                showPlaylist(false);
            }
        };

        function updateConfig(which) {
            //console.info("Config updating...");
            if (which === 1023) {
                sortEnabled = !sortEnabled;
                setLocalStorage("sortSongs", sortEnabled);
            }
            if (which === 666) {
                diffEnabled = !diffEnabled;
                userData.displayDiff = diffEnabled;
                showPlaylist("none"); // Do not update playlist and only show it
                setLocalStorage("displayDiff", diffEnabled);
            }
            var temp = document.querySelectorAll('input[type="checkbox"]');
            for (var f = 0; f < temp.length - 2; f++) {
                config[f] = temp[f].checked;
            }
            setLocalStorage("songsSelected", config);
            songCount = count.val();
            setLocalStorage("songCount", songCount);
            //console.log(config);
            console.info("sortEnabled: " + sortEnabled + ", diffEnabled: " + diffEnabled + ", songCount: " + songCount);
            if (which < 511 || which === 1023) {
                makePlaylist();
            }
        };

        function showPlaylist(direction) {
            var playlistTwoBefore = 0;
            var playlistOneBefore = 0;
            var playlistOneAfter = 0;
            var playlistTwoAfter = 0;
            var debugArray = [];
            var prevBtn = $("#prev");
            var nextBtn = $("#next");
            var menudiv = $("#menudiv");
            menudiv.removeClass("fade");
            if (playlistArray.length > 0) {

                if (direction == true) {
                    // Ensure we are not indexing out of bounds when flicking to the end of the playlist
                    if (playlistIndex < playlistArray.length - 1) {
                        playlistIndex = playlistIndex + 1;
                    }
                }
                if (direction == false) {

                    // Ensure we are not going out of bounds when clicking Previous
                    if (playlistIndex > 0) {
                        playlistIndex = playlistIndex - 1;
                    }
                }
                if ((direction != true) && (direction != false)) {
                    // When the value is neither true or false, keep current index
                    playlistIndex = playlistIndex;
                }

                playlistTwoBefore = playlistIndex - 2;
                playlistOneBefore = playlistIndex - 1;

                if ((playlistIndex - 2) < 0) {
                    twobefore.html("&nbsp;");
                }
                if ((playlistIndex - 1) < 0) {
                    onebefore.html("&nbsp;");
                }
                if ((playlistIndex + 1) <= playlistArray.length - 1) {
                    playlistOneAfter = playlistIndex + 1;
                }
                if ((playlistIndex + 2) <= playlistArray.length - 1) {
                    playlistTwoAfter = playlistIndex + 2;
                }

                debugArray = [playlistTwoBefore, playlistOneBefore, playlistIndex, playlistOneAfter, playlistTwoAfter];

                console.log(debugArray);

                title.html(playlistArray[playlistIndex].name);
                if (diffEnabled == true) {
                    var which = playlistArray[playlistIndex].picked;
                    var strTmp = playlistArray[playlistIndex].diffList[which];
                    title.append("&nbsp;(" + strTmp + ")");
                    console.info("Which: " + which + ", Str: " + strTmp);
                }
                prevBtn.removeClass("hidden");
                nextBtn.removeClass("hidden");
                if (showMode === 1) {
                    twobefore.removeClass("disabled");
                    onebefore.removeClass("disabled");
                    oneafter.removeClass("disabled");
                    twoafter.removeClass("disabled");


                    oneafter.text(playlistArray[playlistOneAfter].name);
                    twoafter.text(playlistArray[playlistTwoAfter].name);
                }

                if (showMode === 1) {
                    twobefore.removeClass("hidden");
                    onebefore.removeClass("hidden");
                    oneafter.removeClass("hidden");
                    twoafter.removeClass("hidden");
                    menudiv.removeClass("fade");

                    if (playlistIndex - 1 >= 0) {
                        onebefore.text(playlistArray[playlistOneBefore].name);
                    }
                    if (playlistIndex - 2 >= 0) {
                        twobefore.text(playlistArray[playlistTwoBefore].name);
                    }

                    if (playlistIndex + 1 > playlistArray.length - 1) {
                        console.warn("About to run out of strings to display! PlaylistOneAfter +");
                        oneafter.html("&nbsp;");
                    }
                    if (playlistIndex + 2 > playlistArray.length - 1) {
                        console.warn("About to run out of strings to display! PlaylistTwoAfter +");
                        twoafter.html("&nbsp;");
                    }
                } else if (showMode === 0 || showMode === 2) {
                    twobefore.addClass("disabled");
                    onebefore.addClass("disabled");
                    oneafter.addClass("disabled");
                    twoafter.addClass("disabled");
                }

                if (showMode === 2) {
                    prevBtn.addClass("hidden");
                    nextBtn.addClass("hidden");
                    menudiv.addClass("fade");
                    var temp = "";
                    var diffStrings = ["<span class='easy'>Easy</span>", "<span class='medium'>Normal</span>", "<span class='hard'>Hard</span>"];
                    for (var c = 0; c < playlistArray.length; c++) {
                        temp = temp + playlistArray[c].name;
                        if (diffEnabled == true) {
                            var which = playlistArray[c].picked;
                            // var strTmp = playlistArray[c].diffList[which];
                            var strTmp = diffStrings[which];
                            temp = temp + ("&nbsp;(" + strTmp + ")<br/>");
                        } else if (diffEnabled == false) {
                            temp = temp + "<br/>"
                        }
                    }
                    title.html(temp);
                }

                counter.text((playlistIndex + 1) + " of " + playlistArray.length + " songs in playlist");
            } else {
                makePlaylist();
                // alert("Please click Make Playlist button first.");
            }
        };

        function updateView(type) {
            showMode = type;
            setLocalStorage("songFormat", showMode);
            showPlaylist();
        };

        function shuffle(array) {
            var m = array.length,
                t, i;
            while (m > 0) {
                i = Math.floor(Math.random() * m--);
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        };

        function generateDiffIndex() {
            var a = Math.floor(Math.random() * 3);
            if (a > 2) {
                a = 2;
            }
            return a;
        }

        function allAreFalse(arr) {
            return arr.every(element => element === false);
        };

        function buttonHandler(which) {
            if (which === true) {
                handleSettingKey(true);
                makePlaylist();
            }
            if (which === false) {
                handleSettingKey(false);
                makePlaylist();
            }
        }

        document.addEventListener("keydown", function(event) {
            if (event.key === "a" || event.key === "A") {
                // Previous
                showPlaylist(false);
            } else if (event.key === "d" || event.key === "D") {
                // Next
                showPlaylist(true);
            } else if (event.key === "w" || event.key === "W") {
                // Increase
                handleSettingKey(true);
                makePlaylist();
            } else if (event.key === "s" || event.key === "S") {
                // Decrease
                handleSettingKey(false);
                makePlaylist();
            } else if (event.key === "z" || event.key === "Z" || event.key === "x" || event.key === "X" || event.key === "c" || event.key === "C" || event.key === "v" || event.key === "V" || event.key === "b" || event.key === "B" || event.key === "n" || event.key === "N" || event.key === "m" || event.key === "M") {
                switch (event.key) {
                    case "z":
                    case "Z":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[0];
                        cb.checked = !cb.checked;
                        break;
                    case "x":
                    case "X":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[1];
                        cb.checked = !cb.checked;
                        break;
                    case "c":
                    case "C":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[2];
                        cb.checked = !cb.checked;
                        break;
                    case "v":
                    case "V":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[3];
                        cb.checked = !cb.checked;
                        break;
                    case "b":
                    case "B":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[4];
                        cb.checked = !cb.checked;
                        break;
                    case "n":
                    case "N":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[5];
                        cb.checked = !cb.checked;
                        break;
                    case "m":
                    case "M":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[6];
                        cb.checked = !cb.checked;
                        break;
                    case "g":
                    case "G":
                        var cb = document.querySelectorAll('input[type="checkbox"]')[7];
                        cb.checked = !cb.checked;
                        break;
                }
                // var checkboxIndex = parseInt(event.key) - 1;
                //var checkboxes = document.querySelectorAll('input[type="checkbox"]')[checkboxIndex]; // Seventh checkbox should be ignored in this argument
                //checkboxes.checked = !checkboxes.checked;
                makePlaylist(); // Regenerate playlist
                playlistIndex = 0; // Reset the song index back to 0
                showPlaylist(); // Display playlist
            } else if (event.key === "q" || event.key === "Q") {
                var checkboxes = document.querySelectorAll('input[type="checkbox"]')
                checkboxes[checkboxes.length - 2].checked = !checkboxes[checkboxes.length - 2].checked
                updateConfig();
            } else if (event.key === "Enter") {
                console.log("Enter key pressed");
                makePlaylist();
            } else if (event.ctrlKey && event.shiftKey && event.key === "E") {
                alert("The one wish I have for everyone in the world is knowing that war is a terrible tragedy and greed is what fuels it, and acting on it to stop the war.\nI am so sick and tired of seeing people lose their lives because of some rich pigs at the top of the pyramid.\nThe pyramid we built.\nThe corruption runs deep, and it must be stopped.");
            }
        })

        function handleSettingKey(dir) {
            var max = count.prop("max");
            var min = count.prop("min");
            var cur = count.val();
            cur = parseInt(cur);
            // console.log("min: " + min +" max: " + max);
            if ((cur > min) && dir == false) {
                cur = cur - 1;
            }
            if ((cur < max) && dir == true) {
                cur = cur + 1;
            }
            count.val(cur);
        }
    </script>
</body>

</html>